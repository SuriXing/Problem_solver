<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>感谢分享 - 解忧杂货铺</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    <i class="fas fa-hands-helping"></i>
                    <span data-i18n="siteName">解忧杂货铺</span>
                </a>
            </div>
            <div class="nav-actions">
                <a href="past-questions.html" class="history-link">
                    <i class="fas fa-history"></i>
                    <span data-i18n="pastQuestions">过往问题</span>
                </a>
                <!-- Language Selector -->
                <div class="language-selector" id="languageSelector">
                    <div class="language-button" id="languageButton">
                        <i class="fas fa-globe"></i> <span data-i18n="language">语言</span>
                    </div>
                    <div class="language-dropdown">
                        <div class="language-option" data-lang="zh-CN" data-i18n="chinese">中文</div>
                        <div class="language-option" data-lang="en" data-i18n="english">English</div>
                        <div class="language-option" data-lang="es" data-i18n="spanish">Español</div>
                        <div class="language-option" data-lang="ja" data-i18n="japanese">日本語</div>
                        <div class="language-option" data-lang="ko" data-i18n="korean">한국어</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="success-view">
            <div class="success-header">
                <div class="success-icon">
                    <i class="fa-solid fa-circle-check"></i>
                </div>
                <h1 class="success-title" data-i18n="thankYouTitle">感谢你的分享</h1>
                <p class="success-subtitle" data-i18n="thankYouSubtitle">你的心声已经被记录，我们会尽快回应</p>
            </div>

            <div class="access-code-container">
                <h2 class="access-code-title" data-i18n="yourAccessCode">你的访问码</h2>
                <div class="access-code-display">
                    <span id="access-code">XXXX-XXXX-XXXX</span>
                    <button id="copy-code-btn" class="copy-code-btn" title="复制访问码">
                        <i class="fa-regular fa-copy"></i>
                    </button>
                </div>
                <p class="access-code-desc" data-i18n="saveAccessCode">请保存这个访问码，以便稍后查看回复</p>
                <button id="view-post-btn" class="view-post-btn">
                    <i class="fas fa-eye"></i> <span data-i18n="viewMyPost">查看我的帖子</span>
                </button>
            </div>

            <div class="success-message">
                <div class="message-card">
                    <div class="message-image">
                        <img src="https://images.unsplash.com/photo-1588345921523-c2dcdb7f1dcd?ixlib=rb-1.2.1&auto=format&fit=crop&w=1050&q=80" alt="信件">
                    </div>
                    <div class="message-info">
                        <div class="message-meta">
                            <span class="message-author">
                                <i class="fa-solid fa-circle-user"></i> 
                                <span data-i18n="yourAnonymousId">你的匿名ID: #</span>
                                <span id="user-id">3842</span>
                            </span>
                            <span class="message-time" data-i18n="justPosted">刚刚发布</span>
                        </div>
                        <div class="message-content">
                            <p id="confession-preview">你的内容将显示在这里...</p>
                        </div>
                        <div class="message-tags" id="confession-tags">
                            <!-- Tags will be inserted by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="success-actions">
                <p class="notification-info" data-i18n="notifyMessage">我们将在有回复时通知你</p>
                <div class="action-buttons">
                    <a href="index.html" class="btn-primary return-home-btn">
                        <i class="fa-solid fa-home"></i> <span data-i18n="returnHome">返回首页</span>
                    </a>
                    <a href="help.html" class="btn-primary help-btn">
                        <i class="fa-solid fa-hands-helping"></i> <span data-i18n="helpOthers">帮助他人</span>
                    </a>
                </div>
            </div>

            <div class="success-info-box">
                <h3><i class="fa-solid fa-circle-info"></i> <span data-i18n="whatHappensNext">接下来会发生什么？</span></h3>
                <ul>
                    <li data-i18n="communityWillSee">我们的社区成员将会看到你的问题并提供帮助</li>
                    <li data-i18n="replyIn24h">通常在24小时内你会收到回复</li>
                    <li data-i18n="emailNotification">如果你提供了邮箱，我们会在有回复时通知你</li>
                    <li data-i18n="checkWithCode">你可以使用访问码通过"过往问题"查看你的问题状态和回复</li>
                </ul>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p data-i18n="copyright">© 2024 解忧杂货铺 - 一个温暖的心灵港湾</p>
        </div>
    </footer>

    <script src="src/i18n.js"></script>
    <script src="src/js/storage-system.js"></script>
    <script src="src/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set up current language variable
            window.currentLanguage = localStorage.getItem('language') || 'zh-CN';
            
            // Initialize i18n after DOM is loaded
            if (window.i18n) {
                window.i18n.init();
            }
            
            // Set up language selector
            setupLanguageSelector();
            
            // Get DOM elements
            const accessCodeSpan = document.getElementById('access-code');
            const copyCodeBtn = document.getElementById('copy-code-btn');
            const viewPostBtn = document.getElementById('view-post-btn');
            const userIdSpan = document.getElementById('user-id');
            const confessionPreview = document.getElementById('confession-preview');
            const confessionTags = document.getElementById('confession-tags');
            
            // Get submission data from localStorage or URL parameters
            const submissionData = getSubmissionData();
            
            // If we have submission data, process it
            if (submissionData) {
                // Generate a unique access code if needed
                if (!submissionData.accessCode && window.StorageSystem) {
                    submissionData.accessCode = window.StorageSystem.generateAccessCode();
                    
                    // Store the submission data with the access code
                    window.StorageSystem.storeData(submissionData.accessCode, submissionData);
                }
                
                // Display the data on the page
                displaySubmissionData(submissionData);
            } else {
                // Use a default access code if no submission data
                if (accessCodeSpan) {
                    // Initialize the storage with our hardcoded access codes if they don't exist
                    if (window.StorageSystem) {
                        // Add the J23B-F42A-LCRZ access code if it doesn't exist
                        if (!window.StorageSystem.checkAccessCode('J23B-F42A-LCRZ')) {
                            const userData = {
                                userId: "7291",
                                accessCode: "J23B-F42A-LCRZ",
                                confessionText: "I have been struggling with my coursework lately. The assignments are getting harder and I'm falling behind. I'm afraid I might fail this semester.",
                                selectedTags: ["Study", "Stress", "Academic"],
                                timestamp: new Date().toISOString(),
                                replies: []
                            };
                            
                            window.StorageSystem.storeData('J23B-F42A-LCRZ', userData);
                        }
                        
                        // Add the TSZT-VVSM-8F8Y access code if it doesn't exist
                        if (!window.StorageSystem.checkAccessCode('TSZT-VVSM-8F8Y')) {
                            const userData = {
                                userId: "9524",
                                accessCode: "TSZT-VVSM-8F8Y",
                                confessionText: "我最近在社交场合感到焦虑，尤其是与新同事交流时。我担心自己说错话或给人留下不好的印象。有谁能给我一些建议如何克服这种社交焦虑？",
                                selectedTags: ["焦虑", "社交", "人际关系"],
                                timestamp: new Date().toISOString(),
                                replies: [
                                    {
                                        replyText: "社交焦虑是非常常见的。试着从小的交流开始，比如先与一两个同事简短交谈。准备一些可以讨论的话题也会有帮助。记住，大多数人都在关注自己的表现，而不是评判你。深呼吸和正念练习也可以帮助缓解焦虑。",
                                        replierName: "Helper #6378",
                                        replyTime: "刚刚"
                                    },
                                    {
                                        replyText: "作为一个曾经有社交焦虑的人，我理解你的感受。一个有用的技巧是提前练习对话，甚至可以在镜子前练习。另外，不要给自己太大压力，与人交流是需要时间和实践的技能。如果焦虑严重，也可以考虑寻求专业心理咨询。",
                                        replierName: "Helper #2935",
                                        replyTime: "5分钟前"
                                    }
                                ]
                            };
                            
                            window.StorageSystem.storeData('TSZT-VVSM-8F8Y', userData);
                        }
                    }
                    
                    // Show your specific access code on the success page
                    accessCodeSpan.textContent = 'TSZT-VVSM-8F8Y';
                }
                
                // Display demo content for this specific access code
                if (userIdSpan) userIdSpan.textContent = '9524';
                if (confessionPreview) confessionPreview.textContent = "我最近在社交场合感到焦虑，尤其是与新同事交流时。我担心自己说错话或给人留下不好的印象。有谁能给我一些建议如何克服这种社交焦虑？";
                if (confessionTags) {
                    confessionTags.innerHTML = '';
                    ['焦虑', '社交', '人际关系'].forEach(tag => {
                        const tagSpan = document.createElement('span');
                        tagSpan.className = 'tag';
                        tagSpan.textContent = tag;
                        confessionTags.appendChild(tagSpan);
                    });
                }
            }
            
            // Add copy access code functionality
            if (copyCodeBtn && accessCodeSpan) {
                copyCodeBtn.addEventListener('click', function() {
                    // Create a temporary textarea to copy the text
                    const textarea = document.createElement('textarea');
                    textarea.value = accessCodeSpan.textContent;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    // Show copied status
                    copyCodeBtn.classList.add('copied');
                    const originalTitle = copyCodeBtn.getAttribute('title');
                    copyCodeBtn.setAttribute('title', window.i18n ? window.i18n.t('copied') : '已复制!');
                    
                    // Reset after short delay
                    setTimeout(() => {
                        copyCodeBtn.classList.remove('copied');
                        copyCodeBtn.setAttribute('title', originalTitle);
                    }, 2000);
                });
            }
            
            // Add view post button functionality
            if (viewPostBtn && accessCodeSpan) {
                viewPostBtn.addEventListener('click', function() {
                    const accessCode = accessCodeSpan.textContent;
                    // Save the access code in localStorage for persistence
                    localStorage.setItem('accessCode', accessCode);
                    // Redirect to past-questions page with the access code
                    window.location.href = `past-questions.html?code=${accessCode}`;
                });
            }
            
            /**
             * Get submission data from localStorage or URL parameters
             * @returns {Object|null} Submission data or null if not found
             */
            function getSubmissionData() {
                // Try to get from localStorage first
                const storedData = localStorage.getItem('submissionData');
                if (storedData) {
                    try {
                        const data = JSON.parse(storedData);
                        // Clear from localStorage to prevent reuse
                        localStorage.removeItem('submissionData');
                        return data;
                    } catch (e) {
                        console.error('Error parsing submission data', e);
                    }
                }
                
                // Try to get from URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const dataParam = urlParams.get('data');
                if (dataParam) {
                    try {
                        return JSON.parse(atob(dataParam));
                    } catch (e) {
                        console.error('Error parsing URL data parameter', e);
                    }
                }
                
                return null;
            }
            
            /**
             * Display submission data on the page
             * @param {Object} data - The submission data to display
             */
            function displaySubmissionData(data) {
                if (accessCodeSpan) accessCodeSpan.textContent = data.accessCode;
                if (userIdSpan) userIdSpan.textContent = data.userId;
                if (confessionPreview) confessionPreview.textContent = data.confessionText;
                
                if (confessionTags && data.selectedTags) {
                    confessionTags.innerHTML = '';
                    data.selectedTags.forEach(tag => {
                        const tagSpan = document.createElement('span');
                        tagSpan.className = 'tag';
                        tagSpan.textContent = tag;
                        confessionTags.appendChild(tagSpan);
                    });
                }
            }
            
            // Function to set up language selector
            function setupLanguageSelector() {
                const languageButton = document.getElementById('languageButton');
                const languageSelector = document.getElementById('languageSelector');
                const languageOptions = document.querySelectorAll('.language-option');
                
                if (!languageButton || !languageSelector) return;
                
                // Toggle dropdown
                languageButton.addEventListener('click', () => {
                    languageSelector.classList.toggle('active');
                });
                
                // Handle language selection
                languageOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        const lang = option.getAttribute('data-lang');
                        
                        // Save language preference
                        localStorage.setItem('language', lang);
                        
                        // Update current language and translate
                        window.currentLanguage = lang;
                        if (window.i18n) {
                            window.i18n.changeLanguage(lang);
                        }
                        
                        // Close dropdown
                        languageSelector.classList.remove('active');
                    });
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (languageSelector && !languageSelector.contains(e.target)) {
                        languageSelector.classList.remove('active');
                    }
                });
            }
        });
    </script>

    <style>
        /* Additional styles for language selector */
        .language-selector {
            position: relative;
            margin-left: 15px;
            display: inline-block;
        }
        
        .language-button {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 6px 12px;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .language-button i {
            margin-right: 5px;
        }
        
        .language-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .language-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 5px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 100;
            min-width: 150px;
            overflow: hidden;
        }
        
        .language-option {
            padding: 10px 15px;
            color: #374151;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .language-option:hover {
            background-color: #f3f4f6;
        }
        
        .language-selector.active .language-dropdown {
            display: block;
        }
        
        /* View post button styles */
        .view-post-btn {
            margin-top: 10px;
            background-color: #f3f4f6;
            color: #4b5563;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
        }
        
        .view-post-btn i {
            margin-right: 5px;
        }
        
        .view-post-btn:hover {
            background-color: #e5e7eb;
        }
    </style>
</body>
</html> 